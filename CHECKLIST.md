# ✅ 部署前完整检查清单

## 🔍 全面检查结果

### 1. ✅ run.sh 脚本
- ✅ 语法正确
- ✅ 自动检查并准备数据
- ✅ 自动训练模型（失败时使用占位符）
- ✅ 自动创建日志目录
- ✅ 错误处理完善

### 2. ✅ 日志系统
- ✅ 日志自动保存到 `logs/bot.log`
- ✅ 同时输出到控制台和文件
- ✅ 日志目录自动创建

### 3. ✅ 自动化流程
- ✅ 数据采集自动化
- ✅ 模型训练自动化（有后备方案）
- ✅ 构建和启动自动化

---

## 📋 使用流程（服务器上）

### 终端 1: 运行机器人
```bash
cd /path/to/poly-auto-trading
./run.sh
```

### 终端 2: 查看日志
```bash
tail -f logs/bot.log
```

---

## ⚠️ 需要手动配置的内容

### 1. 环境变量（必需）
```bash
cd node_bot
cp .env.example .env
nano .env  # 填入真实的 API 密钥
```

### 2. 首次运行可能需要的
- 如果数据不存在，会自动采集（需要几分钟）
- 如果模型不存在，会自动训练（需要几分钟）

---

## 🎯 预期行为

### run.sh 运行时会：
1. ✅ 检查并设置 Python 环境
2. ✅ 检查数据，不存在则采集
3. ✅ 检查模型，不存在则训练（失败时用占位符）
4. ✅ 运行回测（可选，失败不影响）
5. ✅ 启动机器人

### 启动后：
- ✅ 日志同时输出到控制台和 `logs/bot.log`
- ✅ 每 15 分钟产生一次预测
- ✅ 预测和交易记录都会写入日志
- ✅ 可以用 `tail -f logs/bot.log` 实时查看

---

## 🔧 可能的问题和解决方案

### 问题 1: 数据采集失败
**现象**: run.sh 在数据采集步骤卡住或失败

**解决**:
- 检查网络连接
- 减少数据量：`DATA_DAYS=7 ./run.sh`
- 手动采集：`cd node_bot && npm run collect-data 7`

### 问题 2: 模型训练失败
**现象**: run.sh 显示模型训练失败

**解决**:
- 脚本会自动尝试创建占位符模型
- 如果还是失败，检查 Python 环境和依赖
- 可以手动训练：`cd python_model && source venv/bin/activate && python train.py`

### 问题 3: 日志文件不存在
**现象**: `tail -f logs/bot.log` 显示文件不存在

**解决**:
- 等待机器人启动完成（日志目录会在启动时创建）
- 手动创建：`mkdir -p logs`
- 检查路径是否正确

### 问题 4: .env 文件未配置
**现象**: 启动时报错缺少环境变量

**解决**:
- 开发模式下会从 .env.example 自动创建
- 生产模式下必须手动配置
- 检查 `node_bot/.env` 是否存在并包含必要变量

---

## ✅ 最终验证

运行前确认：
- [ ] Node.js 18+ 已安装
- [ ] Python 3.8+ 已安装（如果需要在服务器上训练模型）
- [ ] `.env` 文件已配置（或在开发模式下会自动创建）
- [ ] 有网络连接（用于采集数据和连接 API）

运行后验证：
- [ ] `logs/bot.log` 文件存在且有内容
- [ ] 日志中显示"初始化完成 ✓"
- [ ] 日志中显示"主循环启动"
- [ ] 没有严重错误

---

## 🚀 快速命令

```bash
# 一键启动
./run.sh

# 查看日志（另一个终端）
tail -f logs/bot.log

# 查看状态
cd node_bot && npm run status

# 停止机器人（如果在 run.sh 终端）
Ctrl+C
```

---

✅ **所有检查完成，可以部署！**

